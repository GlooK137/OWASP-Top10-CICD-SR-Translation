# CICD-SEC-7: Небезопасная конфигурация системы
## Определение
Риски, связанные с небезопасной конфигурацией систем, обусловлены недостатками в настройках безопасности, конфигурации и укреплении различных систем в рамках конвейера (например, SCM, CI, репозиторий артефактов), что часто приводит к появлению "низко висящих плодов" для злоумышленников, стремящихся закрепиться в среде.

## Описание
Среды CI/CD состоят из множества систем, предоставляемых различными поставщиками. Чтобы оптимизировать защиту CI/CD, защитники должны уделять особое внимание как коду и артефактам, проходящим по конвейеру, так и устойчивости и надежности каждой отдельной системы.

Подобно другим системам, хранящим и обрабатывающим данные, CI/CD-системы предполагают различные настройки и конфигурации безопасности на всех уровнях - прикладном, сетевом и инфраструктурном. Эти настройки оказывают существенное влияние на уровень безопасности CI/CD-среды и восприимчивость к возможной компрометации. Злоумышленники любого уровня сложности всегда находятся в поиске потенциальных уязвимостей и неправильных конфигураций CI/CD, которые могут быть использованы в своих интересах.

Примеры потенциальных недостатков усиления:
- Самоуправляемая система и/или компонент, использующий устаревшую версию или не имеющий важных патчей безопасности.
- Система с чрезмерно разрешительным контролем сетевого доступа.
- Самоуправляемая система, имеющая административные права на базовую ОС.
- Система с небезопасными конфигурациями. Конфигурации, как правило, определяют ключевые функции безопасности, связанные с авторизацией, контролем доступа, протоколированием и т.д. Во многих случаях стандартный набор конфигураций небезопасен и требует оптимизации.
- Система с неадекватной гигиеной учетных данных - например, учетные данные по умолчанию, которые не отключены, слишком разрешительные программные маркеры и т.д. 

Несмотря на то что использование CI/CD-решений на базе ПО как услуги (SaaS), а не их самостоятельного хостинга, устраняет некоторые потенциальные риски, связанные с укреплением системы и латеральным перемещением в сети, от организаций все равно требуется высокая тщательность при настройке SaaS CI/CD-решений. Каждое решение имеет свой собственный набор уникальных конфигураций безопасности и лучших практик, которые необходимы для поддержания оптимального уровня безопасности.

## Воздействие
Недостатки в защите одной из систем CI/CD могут быть использованы противником для получения несанкционированного доступа к системе или, что еще хуже, для компрометации системы и получения доступа к базовой ОС. Эти недостатки могут быть использованы злоумышленником для манипулирования легитимными потоками CI/CD, получения конфиденциальных токенов и потенциального доступа к производственным средам. В некоторых сценариях эти недостатки могут позволить злоумышленнику перемещаться внутри среды и вне контекста CI/CD-систем.

## Рекомендации
- [ ] Вести реестр используемых систем и версий, включая определение владельца для каждой системы. Постоянно проверяйте наличие известных уязвимостей в этих компонентах. Если доступно исправление, обновите уязвимый компонент. В противном случае следует рассмотреть возможность удаления компонента/системы или уменьшить потенциальное влияние эксплуатации уязвимости путем ограничения доступа к системе или возможности выполнения ею конфиденциальных операций.
- [ ] Обеспечить сетевой доступ к системам в соответствии с принципом наименьшего доступа.
- [ ] Установить процесс периодической проверки всех конфигураций системы на предмет наличия параметров, которые могут повлиять на уровень безопасности системы, и обеспечить оптимальность всех параметров.
- [ ] Убедитесь, что разрешения на узлы выполнения конвейера предоставляются в соответствии с принципом наименьших привилегий. Распространенной ошибкой в данном контексте является предоставление инженерам прав на отладку на узлах исполнения. Хотя во многих организациях это является обычной практикой, необходимо учитывать, что любой пользователь, имеющий доступ к узлу исполнения в режиме отладки, может раскрыть все секреты, пока они загружаются в память, и использовать идентификационные данные узла, что фактически предоставляет повышенные права любому инженеру, имеющему такие права.
## Ссылки
1. Компрометация системы сборки SolarWinds, использовавшаяся для распространения вредоносного ПО через SolarWinds в 18 тыс. организаций.
https://sec.report/Document/0001628280-20-017451/#swi-20201214.htm

2. Бэкдор, внедренный в git-репозиторий PHP. Злоумышленники помещали вредоносный непроверенный код непосредственно в основную ветку PHP, что в конечном итоге приводило к распространению официальной версии PHP среди всех пользователей PHP. Предположительно, атака возникла в результате компрометации самодостаточного git-сервера PHP.
https://news-web.php.net/php.internals/113981

3. Злоумышленник скомпрометировал сервер сборки TeamCity компании Stack Overflow, который был доступен из Интернета.
https://stackoverflow.blog/2021/01/25/a-deeper-dive-into-our-may-2019-security-incident/

4. Злоумышленники взломали непропатченный сервер сборки Webmin и добавили бэкдор в локальную копию кода после его извлечения из репозитория, что привело к атаке по цепочке поставок на серверы, использующие Webmin.
https://www.webmin.com/exploit.html

5. Утечка исходного кода Nissan после того, как самоуправляемый экземпляр Bitbucket остался доступен из Интернета с учетными данными по умолчанию.
https://www.zdnet.com/article/nissan-source-code-leaked-online-after-git-repo-misconfiguration/

6. Утечка исходного кода Mercedes Benz произошла после того, как самоуправляемый сервер GitLab был открыт для самостоятельной регистрации в Интернете.
https://www.zdnet.com/article/mercedes-benz-onboard-logic-unit-olu-source-code-leaks-online/

7. Самоуправляемый GitLab-сервер правительства штата Нью-Йорк был открыт для доступа в Интернет, что позволило любому желающему самостоятельно зарегистрироваться и войти в систему, хранящую секретные данные.
https://techcrunch.com/2021/06/24/an-internal-code-repo-used-by-new-york-states-it-office-was-exposed-online/