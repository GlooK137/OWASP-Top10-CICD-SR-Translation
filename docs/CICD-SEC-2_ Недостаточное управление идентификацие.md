# CICD-SEC-2: Недостаточное управление идентификацией и доступом
## Определение
Риски, связанные с неадекватным управлением идентификацией и доступом, обусловлены трудностями управления огромным количеством идентификационных данных, распределенных по различным системам инженерной экосистемы - от контроля исходных текстов до развертывания. Наличие плохо управляемых идентификационных данных - как человеческих, так и программных учетных записей - увеличивает вероятность и масштабы ущерба от их компрометации.

## Описание
Процессы поставки программного обеспечения состоят из множества систем, связанных между собой с целью перемещения кода и артефактов из разработки в производство. Каждая система предоставляет множество способов доступа и интеграции (имя пользователя и пароль, персональный токен доступа, приложение marketplace, приложения oauth, плагины, ключи SSH). Различные типы учетных записей и методы доступа потенциально могут иметь свой собственный уникальный метод предоставления, набор политик безопасности и модель авторизации. Такая сложность создает проблемы при управлении различными идентификаторами на протяжении всего жизненного цикла идентификации и обеспечении соответствия их разрешений принципу наименьших привилегий.

Более того, в типичной среде средняя учетная запись пользователя SCM или CI обладает высокой степенью свободы действий, поскольку эти системы традиционно не являются предметом пристального внимания служб безопасности. Такие учетные записи используются в основном инженерами, которым необходима гибкость для внесения серьезных изменений в код и инфраструктуру.

К числу основных проблем, связанных с управлением идентификацией и доступом в экосистеме CI/CD, относятся:

- чрезмерно разрешительные идентификаторы - поддержание принципа наименьших привилегий как для приложений, так и для человеческих учетных записей. Например, в SCM - убедиться в том, что каждой человеческой и прикладной учетной записи предоставлены только необходимые разрешения и только для тех репозиториев, к которым она должна иметь доступ, не так-то просто.
- Устаревшие идентификаторы - сотрудники/системы, которые не активны и/или которым больше не требуется доступ, но их человеческие и программные учетные записи во всех системах CI/CD не были депровизированы.
- Локальные учетные записи - системы, доступ к которым не объединен с централизованной IDP, что приводит к созданию учетных записей, управляемых локально в рамках данной системы. Локальные учетные записи создают проблемы при применении согласованных политик безопасности (например, парольной политики, политики блокировки, MFA), а также при правильном депровизировании доступа во всех системах (например, при увольнении сотрудника).
- Внешние идентификаторы -
	- Сотрудники, зарегистрированные на адрес электронной почты из домена, не принадлежащего организации и не управляемого ею. В этом сценарии безопасность этих учетных записей в значительной степени зависит от безопасности внешних учетных записей, которым они назначены. Поскольку эти учетные записи не управляются организацией, они не обязательно соответствуют политике безопасности организации.
	- Внешние сотрудники - после предоставления доступа к системе внешним сотрудникам уровень безопасности системы зависит от уровня безопасности рабочей среды внешнего сотрудника, не контролируемой организацией.
- Самостоятельная регистрация - В системах, где разрешена самостоятельная регистрация, зачастую единственным условием для самостоятельной регистрации и доступа к CI/CD-системам является наличие действующего доменного адреса. Использование стандартного/базового набора прав доступа к системе, отличного от "none", значительно расширяет потенциальную площадь атаки.
- Общие идентификаторы - идентификаторы, разделяемые между пользователями-людьми/приложениями/и людьми, и приложениями, увеличивают отпечаток их учетных данных, а также создают проблемы, связанные с ответственностью в случае возможного расследования.

## Влияние
Наличие сотен (а иногда и тысяч) идентификационных данных - как человеческих, так и программных - в экосистеме CI/CD в сочетании с отсутствием строгих практик управления идентификацией и доступом и распространенным использованием слишком разрешительных учетных записей приводит к тому, что компрометация практически любой учетной записи пользователя в любой системе может предоставить мощные возможности среде и послужить переходом в производственную среду.

## Рекомендации
- [ ] Проводить постоянный анализ и картирование всех идентификационных данных во всех системах инженерной экосистемы. Для каждой идентификационной информации укажите поставщика идентификационных данных, уровень предоставленных и фактически используемых разрешений. Убедитесь, что в ходе анализа охвачены все методы программного доступа.
- [ ] Удалите разрешения, не необходимые для текущей работы каждого идентификатора в различных системах среды.
- [ ] Определите приемлемый период отключения/удаления устаревших учетных записей и отключите/удалите любую учетную запись, которая превысила заданный период бездействия.
- [ ] Избегайте создания локальных учетных записей пользователей. Вместо этого создавайте и управляйте идентификационными данными с помощью централизованного организационного компонента (IdP). Если локальные учетные записи используются, убедитесь, что учетные записи, доступ к которым больше не требуется, отключены/удалены, а политики безопасности для всех существующих учетных записей соответствуют политике организации.
- [ ] Постоянно отслеживайте всех внешних сотрудников и следите за тем, чтобы их идентификационные данные соответствовали принципу наименьших привилегий. По возможности предоставлять разрешения с заранее установленным сроком действия - как для человеческих, так и для программных учетных записей - и отключать учетную запись по окончании работы.
- [ ] Запретить сотрудникам использовать свои личные адреса электронной почты или адреса, принадлежащие доменам, не принадлежащим организации и не управляемым ею, для работы с SCM, CI или любой другой CI/CD-платформой. Постоянно отслеживайте наличие адресов, не принадлежащих домену, в различных системах и удаляйте пользователей, не соответствующих требованиям.
- [ ] Не разрешать пользователям самостоятельно регистрироваться в системах и предоставлять права по мере необходимости.
- [ ] Не предоставлять базовые права в системе всем пользователям, а также большим группам, в которые автоматически назначаются учетные записи пользователей.
- [ ] Избегайте использования общих учетных записей. Создавайте специальные учетные записи для каждого конкретного контекста и предоставляйте именно тот набор разрешений, который необходим для данного контекста.
## Ссылки
1. Компрометация сервера сборки TeamCity от Stack Overflow - злоумышленник смог повысить свои привилегии в среде благодаря тому, что вновь зарегистрированным учетным записям при доступе к системе присваивались административные привилегии.
https://stackoverflow.blog/2021/01/25/a-deeper-dive-into-our-may-2019-security-incident/

2. Утечка исходных текстов Mercedes Benz после того, как к самостоятельному серверу GitLab, размещенному в Интернете, был открыт доступ путем саморегистрации.
https://www.zdnet.com/article/mercedes-benz-onboard-logic-unit-olu-source-code-leaks-online/

3. Самоуправляемый GitLab-сервер правительства штата Нью-Йорк был открыт для доступа в Интернет, что позволило любому желающему самостоятельно зарегистрироваться и войти в систему, хранящую секретные данные.
https://techcrunch.com/2021/06/24/an-internal-code-repo-used-by-new-york-states-it-office-was-exposed-online/

4. Вредоносное ПО добавлено в исходный код дистрибутива Gentoo Linux после того, как был скомпрометирован пароль учетной записи GitHub одного из сопровождающих проекта.
https://wiki.gentoo.org/wiki/Project:Infrastructure/Incident_Reports/2018-06-28_Github